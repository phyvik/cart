
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Title -->
    <title>GoodMeals | Awesome Meals Starting  Rs 69</title>

    <!-- Required Meta Tags Always Come First -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat%3A300%2C400%2C500%2C600%2C700%2C900%7COpen+Sans%3A300%2C400%2C500%2C600%2C700%2C800%7CPlayfair+Display%7CRoboto%7CRaleway%7CSpectral%7CRubik">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/bootstrap.min.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/icon-line-pro/style.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/style.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/style1.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/hamburgers.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/animate.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/masterslider.main.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/cubeportfolio.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/slick.css">

    <!-- CSS Template -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/styles.op-restaurant.css">

    <!-- CSS Customization -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/custom.css">



<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Title -->
    <title>GoodMeals | Awesome Meals Starting  Rs 69</title>

    <!-- Required Meta Tags Always Come First -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat%3A300%2C400%2C500%2C600%2C700%2C900%7COpen+Sans%3A300%2C400%2C500%2C600%2C700%2C800%7CPlayfair+Display%7CRoboto%7CRaleway%7CSpectral%7CRubik">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/bootstrap.min.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/icon-line-pro/style.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/style.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/style1.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/hamburgers.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/animate.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/masterslider.main.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/cubeportfolio.min.css">
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/slick.css">

    <!-- CSS Template -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/styles.op-restaurant.css">

    <!-- CSS Customization -->
    <link rel="stylesheet" href="http://goodmeals.in/assets/css/custom.css">
	<script type="text/javascript">
        var specialKeys = new Array();
        specialKeys.push(8); //Backspace
        function IsNumeric(e) {
            var keyCode = e.which ? e.which : e.keyCode
            var ret = ((keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1);
            document.getElementById("error").style.display = ret ? "none" : "inline";
            return ret;
        }
    </script>
	
  </head>

  <body >
    <main class="g-pt-105">
<!-- Header v1 -->
      <header id="js-header" class="u-header u-header--sticky-top u-header--change-appearance g-z-index-9999"
              data-header-fix-moment="100">
        <div class="u-header__section g-bg-white g-transition-0_3 g-py-16"
             data-header-fix-moment-exclude="g-py-16"
             data-header-fix-moment-classes="u-shadow-v27 g-py-6">
          <nav class="navbar navbar-expand-lg g-py-0">
            <div class="container g-pos-rel">
              <!-- Logo -->
              <a href="#!" class="js-go-to navbar-brand u-header__logo"
                 data-type="static">
                <img class="u-header__logo-img u-header__logo-img--main g-width-140" src="http://goodmeals.in/assets/img/logo.png" alt="Image description">
              </a>
              <!-- End Logo -->

              
              <div class="collapse navbar-collapse align-items-center flex-sm-row" id="navBar">
                <ul id="js-scroll-nav" class="navbar-nav text-uppercase g-font-weight-700 g-font-size-12 g-pt-20 g-pt-0--lg ml-auto">
                  <li class="nav-item g-mr-10--lg g-mb-7 g-mb-0--lg">
                    <a href="#masterslider" class="nav-link p-0">Home</a>
                  </li>
                  <li class="nav-item g-mx-10--lg g-mb-7 g-mb-0--lg">
                    <a href="about.html" class="nav-link p-0">About</a>
                  </li>
                  <li class="nav-item g-mx-10--lg g-mb-7 g-mb-0--lg">
                    <a href="faq.html" class="nav-link p-0">FAQs</a>
                  </li>
                  <li class="nav-item g-mx-10--lg g-mb-7 g-mb-0--lg">
                    <a href="terms.html" class="nav-link p-0">Terms</a>
                  </li>
                  <li class="nav-item g-mx-10--lg g-mb-7 g-mb-0--lg active">
                    <a href="#book" class="nav-link p-0">Book Today's Meal</a>
                  </li>
                </ul>
              </div>

              <button class="navbar-toggler btn g-line-height-1 g-brd-none g-pa-0 g-pos-abs g-top-30 g-right-0" type="button"
                      aria-label="Toggle navigation"
                      aria-expanded="false"
                      aria-controls="navBar"
                      data-toggle="collapse"
                      data-target="#navBar">
                <span class="hamburger hamburger--slider">
                  <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                  </span>
                </span>
              </button>
            </div>
          </nav>
        </div>
		
      </header>
      <!-- End Header v1 -->
		<div id = "book" class = "container-fluid" style = "text-align:center; background-color:#f5efd5">
		<div class="text-center text-uppercase u-heading-v6-2 g-pt-30">
			<h2 class="h3 u-heading-v6__title g-font-size-20">Today's Lunch Meals</h2>
		</div>	
			
			<?php
				$flag = 0;
				if(isset($_GET['phone'])){
					$flag = 1;
					$customerId = $_GET['phone'];
				}else{
					$flag = 0;
				} 
			?>
			<?php
				if($flag == 0) {
			?>	
			 
			<div class = "row" >
				<div class = "col-md-3 g-py-20" style=' margin: auto; width: 50%;border: 3px solid green;  padding: 10px;'>				
					<form action='#' method='GET' name='phnform'>
					  <div class="form-group">
						<h2> Enter Phone number to Proceed </h2>
						<input 
							type="text" 
							maxlength="10" 
							minlength="10" 
							required
							class="form-control" 
							id="exampleInputEmail1" 
							aria-describedby="emailHelp" 
							placeholder="your phone number"
							name='phone'
							onkeypress="return IsNumeric(event);"
							><span id="error" style="color: red; display: inline;">* 10 digit phone number</span>
					  </div>
					  <input 
							type="submit"  
							class="btn btn-primary" 
							name='submit' value='Proceed'>
					</form>
					
				</div> 
			</div> 
			<?php
				}
if($flag == 1) {				
			?>
<?php
// Cart Start
require_once "ShoppingCart.php";
$phn = "2";
$member_id = $phn; // you can your integerate authentication module here to get logged in member
$shoppingCart = new shoppingcart();
if (! empty($_GET["action"])) {
    switch ($_GET["action"]) {
        case "add":
            if (! empty($_POST["quantity"])) {
                
                $productResult = $shoppingCart->getProductByCode($_GET["code"]);
                $cartResult = $shoppingCart->getCartItemByProduct($productResult[0]["id"], $member_id);
                
                if (! empty($cartResult)) {
                    // Update cart item quantity in database
                    $newQuantity = $cartResult[0]["quantity"] + $_POST["quantity"];
                    $shoppingCart->updateCartQuantity($newQuantity, $cartResult[0]["id"]);
                } else {
                    // Add to cart table
					 
                    $shoppingCart->addToCart($productResult[0]["id"], $_POST["quantity"], $member_id);
                }
            }
            break;
        case "remove":
            // Delete single entry from the cart
            $shoppingCart->deleteCartItem($_GET["id"]);
            break;
        case "empty":
            // Empty cart
            $shoppingCart->emptyCart($member_id);
            break;
    }
}
?>
<HTML>
<HEAD>
<TITLE>Enriched Responsive Shopping Cart in PHP</TITLE>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="style.css" type="text/css" rel="stylesheet" />
<script src="jquery-3.2.1.min.js"></script>
<script>
function increment_quantity(cart_id, price) {
    var inputQuantityElement = $("#input-quantity-"+cart_id);
    var newQuantity = parseInt($(inputQuantityElement).val())+1;
    var newPrice = newQuantity * price;
    save_to_db(cart_id, newQuantity, newPrice);
}

function decrement_quantity(cart_id, price) {
    var inputQuantityElement = $("#input-quantity-"+cart_id);
    if($(inputQuantityElement).val() > 1) 
    {
    var newQuantity = parseInt($(inputQuantityElement).val()) - 1;
    var newPrice = newQuantity * price;
    save_to_db(cart_id, newQuantity, newPrice);
    }
}

function save_to_db(cart_id, new_quantity, newPrice) {
	var inputQuantityElement = $("#input-quantity-"+cart_id);
	var priceElement = $("#cart-price-"+cart_id);
    $.ajax({
		url : "update_cart_quantity.php",
		data : "cart_id="+cart_id+"&new_quantity="+new_quantity,
		type : 'post',
		success : function(response) {
			$(inputQuantityElement).val(new_quantity);
            $(priceElement).text("$"+newPrice);
            var totalQuantity = 0;
            $("input[id*='input-quantity-']").each(function() {
                var cart_quantity = $(this).val();
                totalQuantity = parseInt(totalQuantity) + parseInt(cart_quantity);
            });
            $("#total-quantity").text(totalQuantity);
            var totalItemPrice = 0;
            $("div[id*='cart-price-']").each(function() {
                var cart_price = $(this).text().replace("$","");
                totalItemPrice = parseInt(totalItemPrice) + parseInt(cart_price);
            });
            $("#total-price").text(totalItemPrice);
		}
	});
}
</script>

</HEAD>
<BODY>
<?php
$item_quantity = 0;
$item_price = 0;
$cartItem = $shoppingCart->getMemberCartItem($member_id);
if (! empty($cartItem)) {
    $item_quantity = 0;
    $item_price = 0;
    if (! empty($cartItem)) {
        foreach ($cartItem as $item) {
            $item_quantity = $item_quantity + $item["quantity"];
            $item_price = $item_price + ($item["price"] * $item["quantity"]);
        }
    }
}
?>
    <div id="shopping-cart">
        <div class="txt-heading">
            <div class="txt-heading-label">Shopping Cart</div>

            <a id="btnEmpty" href="index.php?action=empty"><img
                src="empty-cart.png" alt="empty-cart" title="Empty Cart"
                class="float-right" /></a>
            <div class="cart-status">
                <div>Total Quantity: <span id="total-quantity"><?php echo $item_quantity; ?></span></div>
                <div>Total Price: <span id="total-price"><?php echo $item_price; ?></span></div>
            </div>
        </div>
<?php
if (! empty($cartItem)) {
    ?>
<div class="shopping-cart-table">
            <div class="cart-item-container header">
                <div class="cart-info title">Title</div>
                <div class="cart-info">Quantity</div>
                <div class="cart-info price">Price</div>
            </div>
<?php
    foreach ($cartItem as $item) {
        
		?>	
				<div class="cart-item-container">
                <div class="cart-info title">
                    
                    <?php echo "<img src=".$item["imageurl"]." style='width:100px;'>";?>
					<?php echo $item["mealorigin"]; ?> 
					
                </div>
                <div class="cart-info quantity">
                    <div class="btn-increment-decrement" onClick="decrement_quantity(<?php echo $item["cart_id"]; ?>, '<?php echo $item["price"]; ?>')">-</div>
						<input class="input-quantity"
                        id="input-quantity-<?php echo $item["cart_id"]; ?>" value="<?php echo $item["quantity"]; ?>"><div class="btn-increment-decrement"
                        onClick="increment_quantity(<?php echo $item["cart_id"]; ?>, '<?php echo $item["price"]; ?>')">+</div>
                </div>

                <div class="cart-info price" id="cart-price-<?php echo $item["cart_id"]; ?>">
                        <?php echo "$". ($item["price"] * $item["quantity"]); ?>
                    </div>


                <div class="cart-info action">
                    <a
                        href="index.php?phone=<?php echo $_GET['phone']; ?>&action=remove&id=<?php echo $item["cart_id"]; ?>"
                        class="btnRemoveAction"><img
                        src="icon-delete.png" alt="icon-delete"
                        title="Remove Item" /></a>
                </div>
            </div>
				<?php
    }
    ?>
</div>
  <?php
}
?>
</div>
<div id="product-grid">
    <div class="txt-heading">
        <div class="txt-heading-label">Products</div>
    </div>
    <?php
    $query = "SELECT * FROM meals";
    $product_array = $shoppingCart->getAllProduct($query);
    if (! empty($product_array)) {
        foreach ($product_array as $key => $value) {
            ?>
        <div class="product-item">
        <form method="post"
			  action="index.php?phone=<?php echo $_GET['phone']?>&action=add&code=<?php echo $product_array[$key]["id"]; ?>">
            <div class="product-image">
                <img src="<?php echo $product_array[$key]["imageurl"]; ?>">
                <div class="product-title">
                    <?php echo $product_array[$key]["mealorigin"]; ?>
                </div>
            </div>
            <div class="product-footer">
                <div class="float-right">
                    <input type="text" name="quantity" value="1"
                        size="2" class="input-cart-quantity" />
					<input type="image"
                        src="add-to-cart.png" class="btnAddAction" />
                </div>
                <div class="product-price float-left" id="product-price-<?php echo $product_array[$key]["id"]; ?>"><?php echo "$".$product_array[$key]["price"]; ?></div>
                
            </div>
        </form>
    </div>
    <?php
        }
    }
    ?>
</div>   
</BODY>
<?php 
//Cart Ends
?>
<?php
}//End Phone number
?>
